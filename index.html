<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>簡單吃角子老虎機（Letters Slot）</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c5cff; --glass: rgba(255,255,255,0.04);
      --text:#e6eef8;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial; margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#07112b 0%, #0b1a2e 100%); color:var(--text)}
    .wrap{width:360px; background:linear-gradient(180deg,var(--card), #071021); padding:20px; border-radius:14px; box-shadow:0 8px 30px rgba(2,6,23,0.6);}
    h1{font-size:18px;margin:0 0 12px;text-align:center}
    .status{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-bottom:12px}
    .balance{background:var(--glass);padding:8px 12px;border-radius:10px;font-weight:600}
    .controls{display:flex;gap:8px;justify-content:center;margin-bottom:14px}
    input[type=number]{width:110px;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.03); color:var(--text); outline:2px solid transparent}
    input[type=number]:focus{outline-color:rgba(124,92,255,0.28)}
    button{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#4bb5ff); color:white;font-weight:700;cursor:pointer;transform:translateZ(0);transition:transform .12s ease, box-shadow .12s ease}
    button:active{transform:translateY(2px)}
    button[disabled]{opacity:.45;cursor:not-allowed}
    button.spin:hover{filter:brightness(1.03); box-shadow:0 6px 20px rgba(124,92,255,0.18)}

    /* 槽輪 */
    .board{display:flex;gap:10px;justify-content:center;align-items:center;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px;margin-bottom:12px}
    .reel{width:78px;height:78px;border-radius:10px;background:linear-gradient(180deg,#0b1622, #071021);display:flex;align-items:center;justify-content:center;font-size:40px;font-weight:800;color:var(--text);letter-spacing:2px;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.6)}

    .message{min-height:36px;text-align:center;font-size:14px}
    .small{font-size:12px;color:rgba(230,238,248,0.7)}
    .rules{font-size:13px;text-align:center;margin-top:8px;color:rgba(230,238,248,0.75)}

    /* 轉動時的字母快速變化效果（使用 JS 控制類名） */
    .shimmer{animation:shimmer 90ms steps(1) infinite}
    @keyframes shimmer{to{opacity:.85}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Letters Slot — 吃角子老虎機</h1>
    <div class="status">
      <div class="balance">餘額：<span id="balance">1000</span> 點</div>
      <div class="small">三個相同：下注 x3，兩個相同：下注 x1.25</div>
    </div>

    <div class="board">
      <div class="reel" id="r1">A</div>
      <div class="reel" id="r2">B</div>
      <div class="reel" id="r3">C</div>
    </div>

    <div class="controls">
      <input id="bet" type="number" min="1" value="10" />
      <button id="spin" class="spin">SPIN</button>
    </div>

    <div class="message" id="message">請輸入下注金額後按「SPIN」。</div>
    <div class="rules">字母：a ~ z（共 26 種）</div>
  </div>

  <script>
    (function(){
      const letters = Array.from({length:26},(_,i)=>String.fromCharCode(97+i)); // a-z
      const r1 = document.getElementById('r1');
      const r2 = document.getElementById('r2');
      const r3 = document.getElementById('r3');
      const spinBtn = document.getElementById('spin');
      const betInput = document.getElementById('bet');
      const msg = document.getElementById('message');
      const balSpan = document.getElementById('balance');

      let balance = 1000;
      let spinning = false;

      function randLetter(){
        return letters[Math.floor(Math.random()*letters.length)];
      }

      function setReel(el, ch){ el.textContent = ch.toUpperCase(); }

      function calcPayout(bet, results){
        // results: array of 3 letters
        const counts = {};
        results.forEach(x=>counts[x] = (counts[x]||0)+1);
        const vals = Object.values(counts);
        if(vals.includes(3)){
          return bet * 3;
        }
        if(vals.includes(2)){
          return Math.round(bet * 1.25 * 100) / 100; // 四捨五入到小數點後2位
        }
        return 0; // 沒中
      }

      function updateBalance(delta){ balance = Math.round((balance + delta) * 100) / 100; balSpan.textContent = balance; }

      function disableControls(v){ spinBtn.disabled = v; betInput.disabled = v; }

      spinBtn.addEventListener('click', ()=>{
        if(spinning) return;
        let bet = Number(betInput.value) || 0;
        if(!Number.isFinite(bet) || bet <= 0){ msg.textContent = '請輸入正確的下注金額（大於 0）。'; return; }
        if(bet > balance){ msg.textContent = '餘額不足。'; return; }

        // 開始轉動
        spinning = true; disableControls(true);
        msg.textContent = '滾動中...';

        // 先扣除下注金額（下注時從餘額扣除，之後再發放中獎金）
        updateBalance(-bet);

        // 快速顯示隨機字母
        const reels = [r1,r2,r3];
        const intervals = [];
        reels.forEach(r=> r.classList.add('shimmer'));
        reels.forEach((r, idx)=>{
          intervals[idx] = setInterval(()=>{ setReel(r, randLetter()); }, 80);
        });

        // 停止時間分別延遲，模擬機械槽輪停止
        const stopDelays = [800, 1200, 1600];
        setTimeout(()=>{ clearInterval(intervals[0]); setReel(r1, randLetter()); }, stopDelays[0]);
        setTimeout(()=>{ clearInterval(intervals[1]); setReel(r2, randLetter()); }, stopDelays[1]);
        setTimeout(()=>{ clearInterval(intervals[2]); setReel(r3, randLetter());
          // 最終結果決定在第三輪停止後
          reels.forEach(r=> r.classList.remove('shimmer'));

          const results = [r1.textContent.toLowerCase(), r2.textContent.toLowerCase(), r3.textContent.toLowerCase()];
          const payout = calcPayout(bet, results);

          if(payout > 0){
            updateBalance(payout);
            msg.innerHTML = `結果： ${results.map(x=>x.toUpperCase()).join(' - ')}。 恭喜中獎！你獲得 ${payout}（含本金）。`;
          }
          else{
            msg.innerHTML = `結果： ${results.map(x=>x.toUpperCase()).join(' - ')}。 沒有中獎，失去 ${bet}。`;
          }

          // 如果餘額為 0，提醒並停用
          if(balance <= 0){ msg.textContent += ' 你的餘額已耗盡。請重新整理頁面以重置。'; disableControls(true); }
          else{ disableControls(false); }
          spinning = false;
        }, stopDelays[2] + 80);
      });

      // 初始化三個字母
      setReel(r1, randLetter()); setReel(r2, randLetter()); setReel(r3, randLetter());
      balSpan.textContent = balance;

      // 小鍵盤支援：按 Enter 也能 Spin
      betInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ spinBtn.click(); } });

    })();
  </script>
</body>
</html>
